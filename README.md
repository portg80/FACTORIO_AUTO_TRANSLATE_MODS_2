# Factorio Mod Translator (EN → RU)

Инструмент для перевода **локализаций модов Factorio** с английского на русский.

Кратко о главном:
1) Позволяет в пару кликов автоматически перевести сотни модов в вашей сборке на русский язык с помощью Gemini ИИ, сохраняет при этом контекст и однородность перевода - один и тот же предмет всегда будет называтся одинаково везде.
2) Код отсылает сразу все файлы локализации для перевода 1 мода, его название и версию, ищет на сайте https://mods.factorio.com/ этот мод и узнает что он добавляет, тематику мода и тд для более правильного перевода.
3) Если у мода есть уже оффициальный перевод, но он неполный, то ИИ не будет изменять этот перевод, а переведет только то что не переведено. (Это реализовано на уровне промпта "не трогай уже переведенные строки")
4) Можно запустить перевод сразу всех модов по порядку, программа запомнит какие моды она уже переводила и переводить их повторно не будет при повторном запуске, не тратя вашы запросы к ИИ в пустую.

---

Подробнее о том как программа работает:
1) берёт архивы модов `.zip` из папки `папка_с_проектом/mods/` (не которая у тебя в папке с игрой, а в папке проекта, тоесть рядом с `main_gpt.py` файлом, читай далее)
2) вытаскивает локализации в рабочую папку рядом `папка_с_проектом/mods/unpacked`
3) дополняет RU недостающими строками из EN (слияние построчное, а не просто полностью замена файла)
4) переводит (рекомендую Gemini, тк тестировал только этот вариант)
5) упаковывает RU файлы обратно в соответствующие `.zip` которые были разархивированы из папки `папка_с_проектом/mods/` на первом шаге, чтобы мод можно было поставить в игру


---

## Получаем Gemini API ключ для перевода через ИИ:

Gemini доступен не везде. Если AI Studio не открывается или ключ не работает - используй VPN.
Я использую VPN с локацией **Нидерланды** (можно также **США**).

Ссылка для создания ключа (Google AI Studio):
https://aistudio.google.com/app/apikey?hl=ru&_gl=1*v4upq5*_ga*NzAyNDc2MTI0LjE3NzIxNzA1MDc.*_ga_P1DBVKWT6V*czE3NzIxNzA1MDYkbzEkZzEkdDE3NzIxNzA1NTUkajExJGwwJGg3MTY4MzM5MDI.

<img width="1872" height="920" alt="image" src="https://github.com/user-attachments/assets/0f972ecd-ee7c-4d61-b707-edcd39fa30bd" />

### После того как создал ключ:
- открой файл `API_KEYS.py`
- вставь ключ в строку `API_KEY_GEMINI = "..."`

Например: 
```
API_KEY_GEMINI = "ouhsdfnfsduoifh9sdhgf9erhgf9egh9hg90herghe0gh08igh0ehg0hg0"
```

⚠️ Лимиты:
- На бесплатном доступе есть дневной лимит запросов **20 запросов в день** на один аккаунт.
- Если нужно больше - можно делать ключи на разных Google-аккаунтах (1 аккаунт = дополнительные 20 запросов в день).

---

# Как переводить моды factorio с помощью моей программы?
Скачай для начала PyCharm:
И Python:

### 1) Скачай этот репозиторий: **Code → Download ZIP** и распакуй.
<img width="1872" height="920" alt="image" src="https://github.com/user-attachments/assets/4a073b33-b161-4d2d-af34-d10506949102" />

### 2) В PyCharm создай **New Project** введи название и всё остальное по умолчанию пусть останется.
### 3) Скопируй **все файлы моей программы** (`*.py`) в свой проект (Те что ты скачал на первом шаге).
<img width="1384" height="1178" alt="image" src="https://github.com/user-attachments/assets/7ef6c1d7-c75a-4c7d-867a-74986530ca00" />

### 4) Создай папку `mods` в корне проекта и закинь туда моды `.zip` (правой кнопкой мыши по главной папке проекта и в ней создаем дирректорию).
<img width="1384" height="1177" alt="image" src="https://github.com/user-attachments/assets/fe6b2519-be9e-44dc-9054-a7196a1850ad" />
<img width="1384" height="1177" alt="image" src="https://github.com/user-attachments/assets/ffc715c9-58ca-401a-bd86-410a2ff95741" />

Пример:
```
project/
  main_gpt.py
  API_KEYS.py
  ...
  mods/
    SomeMod_1.2.3.zip
    AnotherMod_0.9.0.zip
```

### 5) Установи зависимости (в PyCharm → Terminal):
<img width="1384" height="1177" alt="image" src="https://github.com/user-attachments/assets/10d321a1-714d-4564-bc5f-d3358295b719" />

   - Для перевода через **Gemini**:
     `pip install -U google-genai`

   - Для интерактивного режима (пункт 4):
     `pip install requests`

   - Вариант OpenAI (пункт 5) есть, но **я не рекомендую тк не тестировал его ВООБЩЕ**:
     `pip install openai`


### 6) Открой в Pytharm файл main_gpt.py и запусти зеленой кнопкой скрипт
<img width="1078" height="918" alt="image" src="https://github.com/user-attachments/assets/cc7073b3-bc2d-4684-875e-eb128b5b8b0e" />

Внизу откроется меню такое:

<img width="535" height="327" alt="image" src="https://github.com/user-attachments/assets/a43bb12e-ac7f-46ce-aed5-f42e84240671" />

### 7) Пишем номер нужного нам пункта и нажимаетм Enter.

Полная последовательность действий такая:

<img width="1384" height="1177" alt="image" src="https://github.com/user-attachments/assets/4c5ad2c3-56bb-400f-b12f-ca3d3853135a" />

### 8) "1 — Извлечь локализации из архивов"
Разархивирует **только локализации** из модов (`locale/en`, `locale/ru`) в рабочую папку проекта.
Нужно, чтобы переводить “рядом”, не ломая сразу архив.

### 9) "2 — Слить SRC → DST (EN → RU)"
Создаёт/обновляет RU-файлы на основе EN:

- если в RU уже есть переведённые строки — **они сохраняются**
- если в EN есть строки, которых нет в RU — **они добавляются в RU**
- это **слияние и дополнение**, а не “полная замена RU на EN”

Идея: после этого шага в RU файле локализациях будут все строки, которые вообще существуют в моде - и их можно переводить. 
Если у мода уже был какой то перевод но не полный, то скрипт его не затрет, на этом шаге получится микс из оффициального перевода, и строк которые еще не переведены.

### 10) "3 — Добавить заголовки к файлам ru"
Добавляет в начало каждого RU-файла короткие комментарии (название мода + имя файла).
Это для того чтобы ИИ понимал какой файл он сейчас переводит (файлов локализации в некоторых модах бывает несколько).

### 11) "6 — Перевести мод через Gemini (Google Search)"
Основной рабочий вариант.
Автоматически переводит RU-локали через Gemini.
Плюс: используется поиск в интернете по сайту с модами Factorio, чтобы термины переводились адекватнее.

<img width="2560" height="1392" alt="image" src="https://github.com/user-attachments/assets/3db00008-c1a9-43a6-98e2-3c624ab09f41" />


Если упирается в лимиты (ошибка 429 / quota) - скрипт подождёт и попробует снова. Если 20 запросов например закончились, 
закрываем скрипт, меняем ключ апи в файле API_KEYS.py и запускаем снова, **СКРИПТ ЗАПОМИНАЕТ КАКИЕ МОДЫ ОН УЖЕ ПЕРЕВЕЛ И ЗАПИСЫВАЕТ ИХ В** `папка_с_проектом/mods/translated_mods_log.jsonl`

### 12) "0 — Упаковать DST обратно в архивы"
Берёт готовые папки `ru` и **встраивает их обратно в `.zip` модов**.
Важно: он обновляет **только RU-локализацию**, остальное содержимое архива не трогает.


### 13) ПЕРЕНЕСТИ МОДЫ ИЗ ПРОЕКТА В ПАПКУ МОДОВ ИГРЫ  
Из `папка_с_проектом/mods/` те моды которые вы туда помещали на данном этапе уже содержат в себе перевод, их нужно скопировать в папку mods в factorio **с заменой**, обычно она находится в:  `%AppData%\Factorio\mods` (нажми клавиши win + R и вставь туда этот путь)
⚠️ На всякий случай сделай бэкап старых модов `.zip`, скопируй их в другую папку, например на рабочем столе.


## Дополнительный функционал:

### "4 — Интерактивный перевод (Google переводчик + редактирование)"
Переводит в режиме “по строкам”: показывает EN + текущий RU и предлагает вариант перевода.
Можно:
- принять как есть
- исправить руками
- пропустить


### "5 — Перевести мод через OpenAI (web_search)"
⚠️ **Не рекомендую**: у меня нет ключа с балансом, и я это **не тестировал ВООБЩЕ**.
Пункт оставлен как экспериментальный, забудте пока про него, либо если шарите за python то можете сами дописать.


---

## Частые вопросы

**Q: Мод перевёлся один раз, а я хочу перевести заново.**  
A: В режиме Gemini есть лог “уже переводился”. Проще всего удалить запись о моде из файла:
`mods/translated_mods_log.jsonl`
Однако если вы хотите вообще заного перевести мод, тогда нужно будет удалить из папки unpacked папку с названием мода и пройти все шаги с 8 по 13, иначе ИИ получит на вход уже переведенный файл на русский, и переводить там ему будет нечего.

**Q: У мода нет папки ru после извлечения.**  
A: Значит у мода может не быть локализации. Начни с пунктов 8 и 9 — если ru так и не появилась, скорее всего переводить нечего. Обычно такое бывает если это библиотечный мод, который используют другие моды, или пакеты ресурсов для модов, например с текстурами.

**Q: Gemini не работает / пишет region not supported.**  
A: Gemini AI Studio доступен не везде. Используй VPN (Нидерланды или США) и попробуй снова.
